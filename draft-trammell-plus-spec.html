<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Path Layer UDP Substrate Specification</title>

  
<style type="text/css">/*<![CDATA[*/
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

@media screen and (min-width: 1024px) {
  ul.toc, #rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    padding: 0 1em;
    z-index: 1;
  }
  #rfc\.toc {
    top: 16px;
  }
  ul.toc {
    top: 80px;
    overflow: auto;
  }

  body {
    padding-left: 1.5em;
    padding-right: 29em;
  }
}

body {
  font: 15px "Helvetica Neue",Helvetica,Arial,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 130%;
  margin: 2.5em auto;
  max-width: 724px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
  font-size-adjust: 0.5;
  font-weight: 500;
  color: #333;
  line-height: 100%;
  margin: 0.8em 0 0.3em;
}
.title { font-size: 36px; }
h1 { font-size: 30px; }
h2 { font-size: 24px; }
h3, h4 { font-size: 18px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

ul.toc li {
  list-style: none;
  text-indent: -2.5em;
  padding-left: 2.5em;
  padding-bottom: 5px;
  margin: 0;
}
ul.toc ul {
  margin: 0;
}
/* xml2rfc nests ul directly inside ul which messes with the style badly */
ul.toc, ul.toc>ul, ul.toc ul>ul {
  margin: 0 0 0 1.5em;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header {
  width: 100%;
}
table.header td {
  border: none;
  background-color: transparent;
  color: black;
}
.filename {
  color: rgb(119, 119, 119);
  font-size: 23px;
  font-weight: normal;
  height: auto;
  line-height: 100%;
}
#rfc\.abstract+p {
  font-size: 20px;
  font-weight: 300;
  line-height: 130%;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure {
  font-style: italic;
  margin: 0 1.5em;
}

address {
  margin: 10px 0 0;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn {
  font-weight: bold;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

ol, ul, li, p {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
li, p {
  margin-left: 0;
}
address {
  font-style: normal;
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>


  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.2" rel="Chapter" title="2 State Maintenance and Measurement: Basic Header"/>
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Sender Behavior"/>
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Receiver Behavior"/>
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 On-Path State Maintenance using the Basic Header"/>
<link href="#rfc.section.2.3.1" rel="Chapter" title="2.3.1 State Establishment"/>
<link href="#rfc.section.2.3.2" rel="Chapter" title="2.3.2 Bidirectional Stop Signaling"/>
<link href="#rfc.section.2.3.3" rel="Chapter" title="2.3.3 State Rebinding"/>
<link href="#rfc.section.2.4" rel="Chapter" title="2.4 Measurement and Diagnosis using the Basic Header"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Path Communication: Extended Header"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Measurement and Diagnostics using the Extended Header"/>
<link href="#rfc.section.4" rel="Chapter" title="4 IANA Considerations"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Security Considerations"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Acknowledgments"/>
<link href="#rfc.references" rel="Chapter" title="7 Informative References"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.2 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Trammell, B. and M. Kuehlewind" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-trammell-plus-spec-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2017-3-07" />
  <meta name="dct.abstract" content="This document specifies a common Path Layer UDP Substrate (PLUS) wire image for encrypted transport protocols carried over UDP. The base PLUS header carries information for driving a minimal state machine at middleboxes described in " />
  <meta name="description" content="This document specifies a common Path Layer UDP Substrate (PLUS) wire image for encrypted transport protocols carried over UDP. The base PLUS header carries information for driving a minimal state machine at middleboxes described in " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Network Working Group</td>
  <td class="right">B. Trammell</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">M. Kuehlewind</td>
</tr>
<tr>
  <td class="left">Intended status: Experimental</td>
  <td class="right">ETH Zurich</td>
</tr>
<tr>
  <td class="left">Expires: September 8, 2017</td>
  <td class="right">March 07, 2017</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Path Layer UDP Substrate Specification<br />
  <span class="filename">draft-trammell-plus-spec-00</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>This document specifies a common Path Layer UDP Substrate (PLUS) wire image for encrypted transport protocols carried over UDP. The base PLUS header carries information for driving a minimal state machine at middleboxes described in <a href="#I-D.trammell-plus-statefulness">[I-D.trammell-plus-statefulness]</a>, and provides optional exposure of additional information to devices along the path using the mechanism described in <a href="#I-D.trammell-plus-abstract-mech">[I-D.trammell-plus-abstract-mech]</a>.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 8, 2017.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2017 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>2.   <a href="#rfc.section.2">State Maintenance and Measurement: Basic Header</a></li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Sender Behavior</a></li>
<li>2.2.   <a href="#rfc.section.2.2">Receiver Behavior</a></li>
<li>2.3.   <a href="#rfc.section.2.3">On-Path State Maintenance using the Basic Header</a></li>
<ul><li>2.3.1.   <a href="#rfc.section.2.3.1">State Establishment</a></li>
<li>2.3.2.   <a href="#rfc.section.2.3.2">Bidirectional Stop Signaling</a></li>
<li>2.3.3.   <a href="#rfc.section.2.3.3">State Rebinding</a></li>
</ul><li>2.4.   <a href="#rfc.section.2.4">Measurement and Diagnosis using the Basic Header</a></li>
</ul><li>3.   <a href="#rfc.section.3">Path Communication: Extended Header</a></li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Measurement and Diagnostics using the Extended Header</a></li>
</ul><li>4.   <a href="#rfc.section.4">IANA Considerations</a></li>
<li>5.   <a href="#rfc.section.5">Security Considerations</a></li>
<li>6.   <a href="#rfc.section.6">Acknowledgments</a></li>
<li>7.   <a href="#rfc.references">Informative References</a></li>
<li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a></h1>
<p id="rfc.section.1.p.1">This document defines a wire image for a Path Layer UDP Substrate (PLUS), for limited exposure of information from encrypted, UDP-encapsulated transport protocols. The wire image implements signaling to drive the minimal state machine defined in <a href="#I-D.trammell-plus-statefulness">[I-D.trammell-plus-statefulness]</a> as well as optional exposure of additional information to devices along the path using the mechanism described in <a href="#I-D.trammell-plus-abstract-mech">[I-D.trammell-plus-abstract-mech]</a>.</p>
<p id="rfc.section.1.p.2">As discussed in <a href="#I-D.hardie-path-signals">[I-D.hardie-path-signals]</a>, basic information about flows currently exposed by TCP are missing from transport protocols that encrypt their headers. Given the ossification of protocol wire images due to the widespread deployment of stateful network devices that rely on header inspection, this header encryption is necessary to support transport protocol evolution. However, the loss of basic information for on-path state maintenance as well as network performance measurement, diagnostics, and troubleshooting via header encryption makes network management more difficult.  The PLUS wire image defined by this document aims to mitigate this difficulty, allowing deployment of encrypted protocols without loss of essential in- network functionality.</p>
<p id="rfc.section.1.p.3">This wire image is intended primarily to support state maintenance and measurement; the principles of measurement and primitives we aim to support are drawn from recent work on explicit measurability in protocol design <a href="#IPIM">[IPIM]</a>.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#basic-header" id="basic-header">State Maintenance and Measurement: Basic Header</a></h1>
<p id="rfc.section.2.p.1">Every packet in each direction of a flow using PLUS carries a PLUS header. This can be either a basic header, or an extended header. The PLUS basic header supports multiplexing using a connection token; basic state maintenance using association and confirmation signals, packet serial numbers, and a two-way stop signal; and basic measurability using packet serial number echo. The format of the basic header, together with the UDP header, is shown in <a href="#fig-header-basic">Figure 1</a>.</p>
<p id="rfc.section.2.p.2">The extended header is defined in <a href="#extended-header">Section 3</a>.</p>
<div id="rfc.figure.1"/>
<div id="fig-header-basic"/>
<pre>
  3                   2                   1
1 0 9 8 7 6 5 4 3 2 1 0 9 8 7 6 5 4 3 2 1 0 9 8 7 6 5 4 3 2 1 0
+------------------------------+-------------------------------+
|       UDP source port        |      UDP destination port     |
+------------------------------+-------------------------------+
|       UDP length             |      UDP checksum             |
+------------------------------+-----------------------+-+-+-+-+
|                            magic                     |L|R|S|0|
+------------------------------------------------------+-+-+-+-+
|                                                              |
+-             connection/association token CAT               -+
|                                                              |
+--------------------------------------------------------------+
|                 packet serial number  PSN                    |
+--------------------------------------------------------------+
|                 packet serial echo    PSE                    |
+--------------------------------------------------------------+
/                                                              \
\         transport protocol header/payload (encrypted)        /
/                                                              \
</pre>
<p class="figure">Figure 1: PLUS header with basic exposure</p>
<p id="rfc.section.2.p.3">Fields are encoded in network byte order and are defined as follows:</p>
<p/>

<ul>
  <li>magic: A 28-bit number identifying this packet as carrying a PLUS header. This magic number is chosen to avoid collision with possible values of the first four bytes of widely deployed protocols on UDP. The value 0xd8007ff has been provisionally selected for the PLUS magic number based of experience with the SPUD prototype, a cursory survey of common UDP protocols, and compatibility with <a href="#RFC8035">[RFC8035]</a>.</li>
  <li>flags: four bits carrying additional information: <ul><li>LoLa flag (L): Packet is latency sensitive and prefers drop to delay when set.</li><li>RoI flag (R): Packet is not sensitive to reordering when set.</li><li>Stop flag (S): Packet carries a stop or stop confirmation when set.</li><li>Extended Header bit: Flag bit 0x01 is zero in packets with a Basic Header.</li></ul></li>
  <li>Connection/Association Token (CAT): A 64-bit token identifying this association. The CAT should be chosen randomly by the connection initiator.  The CAT performs two functions in the PLUS header:  <ul><li>Multiplexing: PLUS packets on the same 5-tuple with a different CAT value are taken to belong to a separate flow, with completely separate state.</li><li>Rebinding: A PLUS packet sharing one endpoint (source address/port pair, or destination address/port pair) and the CAT with an existing flow is taken to belong to that flow, since the other endpoint identifier has changed due to a mobility event or address translation change.</li></ul></li>
  <li>Packet Serial Number (PSN): A 32-bit serial number for this packet. The first PSN for each direction in a flow is chosen randomly, and subsequent packets increment the PSN by one. The PSN wraps around.</li>
  <li>Packet Serial Echo (PSE): The most recent PSN seen by the sender in the opposite direction before this packet was sent.</li>
</ul>
<p id="rfc.section.2.p.5">Since PLUS is designed to be used for UDP-encapsulated, encrypted transport protocols, overlying transports are presumed to provide encryption and integrity protection for their own headers. For the sake of efficiency, it is also assumed that this integrity protection can be extended to the bits in the PLUS Basic Header.</p>
<h1 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a> <a href="#sender-behavior" id="sender-behavior">Sender Behavior</a></h1>
<p id="rfc.section.2.1.p.1">When a sender has a packet ready to send using PLUS, it determines the values in the Basic Header as follows:</p>
<p/>

<ul>
  <li>The magic number is set to the constant 0xd8007ff.</li>
  <li>If the sender is the flow initiator, and the packet is the first packet in the flow, the sender selects a cryptographically random 64-bit number for the CAT. When multiplexing, it must ensure the CAT is not already in use for the 5-tuple. Otherwise, the sender uses the CAT associated with the flow.</li>
  <li>If the packet is the first packet in the flow in this direction, the sender selects a cryptographically random 32-bit number for the PSN. Otherwise, the sender adds one to the PSN on the last packet it sent in this flow, and uses that value for the PSN. If the last PSN is 0xffffffff, it wraps around, setting the PSN to 0x00000001. A PSN of 0x00000000 is never sent.</li>
  <li>If the packet is the first packet in the flow in this direction, the sender sets the PSE to 0x00000000. Otherwise it sets the PSE to the PSN of the last packet seen in the opposite direction.</li>
  <li>If the overlying transport determines that this packet is loss-insensitive but latency-sensitive, the sender sets the L flag.</li>
  <li>If the overlying transport determines that this packet may be freely reordered, the sender sets the R flag.</li>
  <li>If the overlying transport determines that the connection is shutting down, and no further packets will be sent in this direction other than packets part of this shutdown, the sender sets the S flag; see <a href="#twostop">Section 2.3.2</a> for details.</li>
</ul>
<h1 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a> <a href="#receiver-behavior" id="receiver-behavior">Receiver Behavior</a></h1>
<p id="rfc.section.2.2.p.1">When a receiver receives a packet containing a PLUS Basic Header, it processes the values in the Basic Header as follows:</p>
<p/>

<ul>
  <li>It verifies that the magic number is the constant 0xd800fff. If the receiver is expecting a PLUS packet, and it does not see this value, it drops the packet without further processing.</li>
  <li>It verifies the integrity of the information in the PLUS Basic Header, using information carried in the overlying transport. Packets failing integrity checks SHOULD be dropped, but MAY be further analyzed by the receiver to determine the likely cause of verification failure; reaction to the failure is transport and implementation specific.</li>
  <li>It stores the PSN to be sent as the PSE on the the next packet it sends in the opposite direction.</li>
</ul>
<h1 id="rfc.section.2.3"><a href="#rfc.section.2.3">2.3.</a> <a href="#on-path-state-maintenance-using-the-basic-header" id="on-path-state-maintenance-using-the-basic-header">On-Path State Maintenance using the Basic Header</a></h1>
<p id="rfc.section.2.3.p.1">The basic header provides all the signals necessary to drive the transport- independent state machine described in <a href="#I-D.trammell-plus-statefulness">[I-D.trammell-plus-statefulness]</a>, as shown in <a href="#fig-states">Figure 2</a>.</p>
<div id="rfc.figure.2"/>
<div id="fig-states"/>
<pre>
    `- - - - - - - - - - - - - - - - - - - - - - - - - - - -'
    `    +============+    a-&gt;b    +============+           '
    `   /              \---------&gt;/              \&lt;-+       '
  +---&gt;(      zero      )        (    uniflow     ) | a-&gt;b  '
  ^ `   \              /&lt;---------\              /--+       '
  | `    +============+  TO_IDLE   +============+           '
  | `- - - - - - - - - - - - - - -  | b-&gt;a - - - - - - - - -'
  |                                 V
  |                          +============+  
  | TO_IDLE                 /              \ 
  +&lt;-----------------------(  associating   )
  |                         \              / 
  |                          +============+  
  |                                 | a-&gt;b
  |                                 V       
  |                          +============+ 
  | TO_ASSOCIATED           /              \&lt;-+     
  +&lt;-----------------------(   associated   ) | a&lt;-&gt;b
  |                         \              /--+     
  |                          +============+ 
  |                             | stop y-&gt;z   
  |                             V             
  |                    +============+  
  | TO_ASSOCIATED     /              \&lt;-+     
  +&lt;-----------------(    stop-wait   ) | a&lt;-&gt;b
  |                   \              /--+          
  |                   +============+       
  |                       | stop z-&gt;y
  |                       V
  |              +============+
  | TO_STOPPING /              \
  +------------(    stopping     )
                \              /
                 +============+
</pre>
<p class="figure">Figure 2: Transport-independent state machine as implemented by PLUS</p>
<h1 id="rfc.section.2.3.1"><a href="#rfc.section.2.3.1">2.3.1.</a> <a href="#state-establishment" id="state-establishment">State Establishment</a></h1>
<p id="rfc.section.2.3.1.p.1">On the first packet with a PLUS header forwarded by an on-path device for a given 5-tuple plus CAT, the device moves that flow from the zero state to the uniflow state. The device retuens the flow to zero state after not seeing a packet on the same flow in the same direction with the same CAT within a timeout interval TO_IDLE. Otherwise, it stays in uniflow state and continues forwarding packets, as long as it only observes packets in the same direction as the initial packet. (the a-&gt;b direction in <a href="#fig-states">Figure 2</a>).</p>
<p id="rfc.section.2.3.1.p.2">A PLUS-aware on-path device forwarding a packet with a PLUS header with a reversed 5-tuple and identical CAT (the b-&gt;a direction in <a href="#fig-states">Figure 2</a>) to a flow in the uniflow state, moves that flow to the associating state. It then waits to see a packet with a PSE in the a-&gt;b direction equal to the PSN on the first reverse packet; on receipt of this packet, the device moves the flow to associated state. Otherwise, it drops state after a timeout interval TO_IDLE.</p>
<p id="rfc.section.2.3.1.p.3">Once a flow has moved to the associated state, it will remain in that state for a timeout interval TO_ASSOCIATED. The on-path device forwards any packet with a PLUS header in either direction for this flow. It resets the TO_ASSOCIATED timer for every packet it forwards in this state.</p>
<h1 id="rfc.section.2.3.2"><a href="#rfc.section.2.3.2">2.3.2.</a> <a href="#twostop" id="twostop">Bidirectional Stop Signaling</a></h1>
<p id="rfc.section.2.3.2.p.1">A PLUS-aware on-path device forwarding a packet for a flow in the associated state with an S flag set moves that flow to stop-wait state. It stores the PSN on the packet causing the transition, and continues forwarding packets as if in associated state, dropping state on timeout interval TO_ASSOCIATED.</p>
<p id="rfc.section.2.3.2.p.2">When it sees a packet in the opposite direction with the S flag set and the PSE set to exactly the stored PSN, it transitions the flow to stopping state.  The device will forward packets in both directions for flows in the stopping state within a timeout interval TO_STOPPING; these packets will not reset the timer.</p>
<p id="rfc.section.2.3.2.p.3">Note that even though the S flag is integrity-protected end to end, a packet with the S flag set could be forged by one on-path device to drive the flow into stop-wait state on all downstream devices. However, this forgery is of severely limited utility. First, it would require coordination between attackers on both sides of a given on-path device in order to forge a confirmation of the stop signal &#8211; a flag with the S bit set and a valid PSE corresponding to the PSN of the first stop signal to drive the flow into stopping state. Second, the information in the Basic Header on each packet will drive the state machine into associated state even in the middle of a flow, enabling fast recovery even in the case of such a coordinated attack.</p>
<h1 id="rfc.section.2.3.3"><a href="#rfc.section.2.3.3">2.3.3.</a> <a href="#state-rebinding" id="state-rebinding">State Rebinding</a></h1>
<p id="rfc.section.2.3.3.p.1">One end of a PLUS association may change its address while maintaining on-path state; e.g. due to a NAT change. A PLUS-aware on-path device that forwards a packet for a flow in the zero state, where one of the endpoint identifiers (address and port) and the CAT, but not the other endpoint identifier, match a flow in a non-zero state, treats that packet as belonging to the existing flow, and updates the endpoint identifier.</p>
<h1 id="rfc.section.2.4"><a href="#rfc.section.2.4">2.4.</a> <a href="#measurement-and-diagnosis-using-the-basic-header" id="measurement-and-diagnosis-using-the-basic-header">Measurement and Diagnosis using the Basic Header</a></h1>
<p id="rfc.section.2.4.p.1">The basic header trivially supports passive two-way delay measurement as well as partial loss estimation at a single observation point on path.</p>
<p id="rfc.section.2.4.p.2">To calculate two-way delay, an observation point calculates the delay between seeing a PSN and a corresponding PSE in each direction, then adds the delays from each direction together. The fact that the PSN increments by one for every packet makes this measurement much simpler than the equivalent measurement using TCP sequence and acknowledgment numbers.</p>
<p id="rfc.section.2.4.p.3">[EDITOR&#8217;S NOTE: specify this fully.]</p>
<p id="rfc.section.2.4.p.4">Loss and reordering upstream from an observation point in each direction can be estimated through examination of the PSN sequence observed. A skipped PSN not seen within a specified interval can be counted as a lost packet, and the extent of reordering estimated by the degree of skipping seen in those skipped PSNs that are later observed. Since PLUS does not expose information about retransmissions (and, indeed, may not even carry a transport that uses retransmission for loss recovery), loss downstream from the observation point cannot be observed.</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#extended-header" id="extended-header">Path Communication: Extended Header</a></h1>
<p id="rfc.section.3.p.1">Additional facilities for communicating with on-path devices under endpoint control are provided by the PLUS Extended Header. The extended header shares the layout of its first 20 bytes with the PLUS Basic Header, except the Extended Header bit (0x01 on byte 11) is set. As with the Basic Header, overlying transports are presumed to provide encryption and integrity protection for the PLUS Extended Header. The Extended Header has three extra fields:</p>
<p/>

<ul>
  <li>PCF Length: an 8-byte value defining the length of the PCF value, from 0 to <ol><li>Add 22 to this value to get the offset of the PLUS payload (i.e., the overlying transport header). The PLUS Extended Header is therefore 22 to 277 octets long.</li></ol></li>
  <li>P bit: If set, the PCF is a Path to Receiver PCF, to be written by devices along the path, and its presence and length (but not content) will be integrity-protected end-to-end. If clear, the PCF is a Sender to Path PCF, and its presence, length, and content will be integrity-protected end-to-end.</li>
  <li>X bit: Reserved for future extension of the PCF type system.</li>
  <li>PCF Type: a 6-byte value defining the type of the PCF value; there are therefore 64 distinct Sender to Path and 64 distinct Path to Receiver PCFs available.</li>
</ul>
<p id="rfc.section.3.p.3">Further details of PCF encoding are not yet defined in this revision of the specification; the remainder of this section discusses the types of information elements to be supported. The exact encoding of PCF type and value information are to be derived from an analysis of the requirements of these Information Elements.</p>
<div id="rfc.figure.3"/>
<div id="fig-header-pcf"/>
<pre>
  3                   2                   1
1 0 9 8 7 6 5 4 3 2 1 0 9 8 7 6 5 4 3 2 1 0 9 8 7 6 5 4 3 2 1 0
+------------------------------+-------------------------------+
|       UDP source port        |      UDP destination port     |
+------------------------------+-------------------------------+
|       UDP length             |      UDP checksum             |
+------------------------------+-----------------------+-+-+-+-+
|                            magic                     |L|R|S|1|
+------------------------------------------------------+-+-+-+-+
|                                                              |
+-             connection/association token CAT               -+
|                                                              |
+--------------------------------------------------------------+
|                 packet serial number  PSN                    |
+--------------------------------------------------------------+
|                 packet serial echo    PSE                    |
+---------------+-+-+-----------+------------------------------+
|   PCF Length  |P|X| PCF Type  |                              /
+---------------+-+-+-----------+                              \
\                                                              /
/                    PCF  (variable-length)                    \
\                                                              /
+--------------------------------------------------------------+
/                                                              \
\         transport protocol header/payload (encrypted)        /
/                                                              \
</pre>
<p class="figure">Figure 3: PLUS extended header</p>
<p id="rfc.section.3.p.4">As described in <a href="#I-D.trammell-plus-abstract-mech">[I-D.trammell-plus-abstract-mech]</a>, there are two types of signals: Path to Receiver signals, which allow devices along the path to provide information about the path or its treatment of the flow to the receiver; and Sender to Path signals, which allow the sender to expose information about itself or the flow to the path. Path to Receiver signals are treated specially by header integrity protection, as their values, but not length or type, may be changed by devices on path: the value of a given path- to-receiver signal is assumed to be an appropriately sized array of zero bytes by the integrity protection facility.</p>
<p id="rfc.section.3.p.5">Path to Receiver signals generally take the form of accumulators: initialized to some value by the sender, and subject to some aggregation function by each on-path device that understands them. Sender to Path signals are generally used to expose information about the traffic for measurement or diagnostic purposes. In any case, the information sent and received is to be treated as advisory only.</p>
<h1 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> <a href="#measurement-and-diagnostics-using-the-extended-header" id="measurement-and-diagnostics-using-the-extended-header">Measurement and Diagnostics using the Extended Header</a></h1>
<p id="rfc.section.3.1.p.1">We have identified the following sender to path signals as potentially useful for measurement and diagnostic purposes. These signals are advisory only, and should not be presumed by either the endpoints or devices along the path to affect forwarding behavior.</p>
<p/>

<ul>
  <li>Packet number echo delta time. Exposes the interval between the receipt of the packet whose number appears in the PSE and the transmission of this packet, as in section 4.1.2 of <a href="#IPIM">[IPIM]</a>. Together with analysis of the PSN and PSE sequence, this allows high-precision RTT estimation.</li>
  <li>Timestamp and timestamp echo. Similar to TCP timestamps in <a href="#RFC7323">[RFC7323]</a>, allows constant-rate clock exposure to devices on path. Note that this is less necessary for RTT measurement of one-sided flows than it is in TCP, due to the properties of the PSN and PSE values in the Basic Header.</li>
</ul>
<p id="rfc.section.3.1.p.3">We have identified the following path to receiver signals as potentially useful. Note that accumulated values for use at the sender must be fed back to the sender by the overlying transport, and that the presence of non-PLUS aware devices on path at breaks in MTU mean that the accumulated value can only be used as a hint to processes for measurement and discovery of the accumulated values at the sender.</p>
<p/>

<ul>
  <li>MTU accumulator. This signal allows measurement of MTU information from PLUS-aware devices. The sender sets the initial value to the sender&#8217;s MTU. A PLUS-aware forwarding device on path receiving this value fills in the minimum of the received value and the MTU of the next hop into this field. The information, when fed back to the sender, can be used as a hint for a running PLPMTUD <a href="#RFC4821">[RFC4821]</a> process.</li>
  <li>State timeout accumulator. This signal allows measurement of timeouts from PLUS-aware devices. It is initialized to a maximum (&#8220;no information&#8221;) value by the sender. A PLUS-aware forwarding device on path receiving this value fills in the minimum of the received value and the configured timeout for the flow&#8217;s present state into this field.</li>
  <li>Rate limit accumulator. This signal allows exposure of rate limiting along the path. It is initialized to a maximum (&#8220;no information&#8221;) value by the sender. A PLUS-aware forwarding device on path receiving this value fills in the minimum of the received value and the rate limit to which this flow is subject into this field.</li>
  <li>Trace accumulator. This signal allows exposure of a trace of PLUS-aware devices on path, similar to the Path Changes mechanism in section 4.3 of <a href="#IPIM">[IPIM]</a>. The sender initializes the value to a value chosen randomly for the flow; all packets in the flow using path trace accumulator must use the same initial value. A PLUS-aware forwarding device on path receiving this value fills in the result of XORing the received value with a randomly chosen device identifier, which it must use for all path trace accumulator signals it participates in. Packets traversing the same set of PLUS-aware forwarding devices in the same flow therefore arrive at the receiver with the same accumulated value, and changes to the set of devices on path can be detected by the receiver.</li>
</ul>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a></h1>
<p id="rfc.section.4.p.1">This document has no actions for IANA. Path communication field types and PLUS magic numbers may be moved to a Standards Action registry in a future revision.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a></h1>
<p id="rfc.section.5.p.1">This document describes the PLUS Basic and Extended Headers, and the protocol they support. This protocol can be used to expose information to devices along the path to replace the analysis of transport- and application-layer headers when those headers are encrypted. Care must be taken in the exposure of such information to ensure no irrelevant application and/or user confidential information is exposed.</p>
<p id="rfc.section.5.p.2">PLUS itself contains some security-relevant features. In concert with an encrypted overlying transport, the PLUS Basic and Extended Headers are integrity-protected to prevent manipulation on-path of any value except Path to Receiver values; this integrity protection prevents Path to Receiver values from being injected without explicit sender involvement, or from being stripped from the PLUS Extended Header.</p>
<p id="rfc.section.5.p.3">The CAT and PSE described in <a href="#basic-header">Section 2</a> taken together, provide entropy to prevent on-path devices from being driven into incorrect states by off-path attackers. Bidirectional stop signaling as in <a href="#twostop">Section 2.3.2</a> requires an on-path attacker of a given middlebox to forge traffic on both of the middlebox&#8217;s interfaces to drive a middlebox to inappropriately drop state for a flow.</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#acknowledgments" id="acknowledgments">Acknowledgments</a></h1>
<p id="rfc.section.6.p.1">This work is partially supported by the European Commission under Horizon 2020 grant agreement no. 688421 Measurement and Architecture for a Middleboxed Internet (MAMI), and by the Swiss State Secretariat for Education, Research, and Innovation under contract no. 15.0268. This support does not imply endorsement.</p>
<h1 id="rfc.references"><a href="#rfc.references">7.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.hardie-path-signals">[I-D.hardie-path-signals]</b>
      </td>
      <td class="top"><a>Hardie, T.</a>, "<a href="http://tools.ietf.org/html/draft-hardie-path-signals-00">Path signals</a>", Internet-Draft draft-hardie-path-signals-00, October 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-quic-transport">[I-D.ietf-quic-transport]</b>
      </td>
      <td class="top"><a>Iyengar, J.</a> and <a>M. Thomson</a>, "<a href="http://tools.ietf.org/html/draft-ietf-quic-transport-01">QUIC: A UDP-Based Multiplexed and Secure Transport</a>", Internet-Draft draft-ietf-quic-transport-01, January 2017.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.trammell-plus-abstract-mech">[I-D.trammell-plus-abstract-mech]</b>
      </td>
      <td class="top"><a>Trammell, B.</a>, "<a href="http://tools.ietf.org/html/draft-trammell-plus-abstract-mech-00">Abstract Mechanisms for a Cooperative Path Layer under Endpoint Control</a>", Internet-Draft draft-trammell-plus-abstract-mech-00, September 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.trammell-plus-statefulness">[I-D.trammell-plus-statefulness]</b>
      </td>
      <td class="top"><a>Kuehlewind, M.</a>, <a>Trammell, B.</a> and <a>J. Hildebrand</a>, "<a href="http://tools.ietf.org/html/draft-trammell-plus-statefulness-02">Transport-Independent Path Layer State Management</a>", Internet-Draft draft-trammell-plus-statefulness-02, December 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="IPIM">[IPIM]</b>
      </td>
      <td class="top"><a>Allman, M.</a>, <a>Beverly, R.</a> and <a>B. Trammell</a>, "<a>Principles for Measurability in Protocol Design (arXiv preprint 1612.02902)</a>", December 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC0793">[RFC0793]</b>
      </td>
      <td class="top"><a>Postel, J.</a>, "<a href="http://tools.ietf.org/html/rfc793">Transmission Control Protocol</a>", STD 7, RFC 793, DOI 10.17487/RFC0793, September 1981.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2474">[RFC2474]</b>
      </td>
      <td class="top"><a>Nichols, K.</a>, <a>Blake, S.</a>, <a>Baker, F.</a> and <a>D. Black</a>, "<a href="http://tools.ietf.org/html/rfc2474">Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers</a>", RFC 2474, DOI 10.17487/RFC2474, December 1998.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4821">[RFC4821]</b>
      </td>
      <td class="top"><a>Mathis, M.</a> and <a>J. Heffner</a>, "<a href="http://tools.ietf.org/html/rfc4821">Packetization Layer Path MTU Discovery</a>", RFC 4821, DOI 10.17487/RFC4821, March 2007.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7323">[RFC7323]</b>
      </td>
      <td class="top"><a>Borman, D.</a>, <a>Braden, B.</a>, <a>Jacobson, V.</a> and <a>R. Scheffenegger</a>, "<a href="http://tools.ietf.org/html/rfc7323">TCP Extensions for High Performance</a>", RFC 7323, DOI 10.17487/RFC7323, September 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7675">[RFC7675]</b>
      </td>
      <td class="top"><a>Perumal, M.</a>, <a>Wing, D.</a>, <a>Ravindranath, R.</a>, <a>Reddy, T.</a> and <a>M. Thomson</a>, "<a href="http://tools.ietf.org/html/rfc7675">Session Traversal Utilities for NAT (STUN) Usage for Consent Freshness</a>", RFC 7675, DOI 10.17487/RFC7675, October 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC8035">[RFC8035]</b>
      </td>
      <td class="top"><a>Holmberg, C.</a>, "<a href="http://tools.ietf.org/html/rfc8035">Session Description Protocol (SDP) Offer/Answer Clarifications for RTP/RTCP Multiplexing</a>", RFC 8035, DOI 10.17487/RFC8035, November 2016.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Brian Trammell</span> 
	  <span class="n hidden">
		<span class="family-name">Trammell</span>
	  </span>
	</span>
	<span class="org vcardline">ETH Zurich</span>
	<span class="adr">
	  <span class="vcardline">Gloriastrasse 35</span>

	  <span class="vcardline">
		<span class="locality">8092 Zurich</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Switzerland</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ietf@trammell.ch">ietf@trammell.ch</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Mirja Kuehlewind</span> 
	  <span class="n hidden">
		<span class="family-name">Kuehlewind</span>
	  </span>
	</span>
	<span class="org vcardline">ETH Zurich</span>
	<span class="adr">
	  <span class="vcardline">Gloriastrasse 35</span>

	  <span class="vcardline">
		<span class="locality">8092 Zurich</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Switzerland</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mirja.kuehlewind@tik.ee.ethz.ch">mirja.kuehlewind@tik.ee.ethz.ch</a></span>

  </address>
</div>

</body>
</html>
